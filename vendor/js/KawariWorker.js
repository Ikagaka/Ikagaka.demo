// Generated by CoffeeScript 1.8.0
var shiori, shiorihandler;

self.importScripts("encoding.min.js");

self.importScripts("kawari.js");

self.importScripts("nativeshiori.js");

shiori = new Kawari();

shiori.Module.logReadFiles = true;

shiorihandler = null;

self.onmessage = function(_arg) {
  var code, data, error, event, request, response, _ref;
  _ref = _arg.data, event = _ref.event, data = _ref.data;
  switch (event) {
    case "load":
      shiorihandler = new NativeShiori(shiori, data, true);
      try {
        code = shiorihandler.load('/home/web_user/');
      } catch (_error) {
        error = _error;
      }
      return self.postMessage({
        event: "loaded",
        error: error,
        data: code
      });
    case "request":
      request = data;
      try {
        response = shiorihandler.request(request);
      } catch (_error) {
        error = _error;
      }
      return self.postMessage({
        event: "response",
        error: error,
        data: response
      });
    case "unload":
      try {
        code = shiorihandler.unload();
      } catch (_error) {
        error = _error;
      }
      return self.postMessage({
        event: "unloaded",
        error: error,
        data: code
      });
    default:
      throw new Error(event + " event not support");
  }
};
